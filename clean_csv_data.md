# clean_csv_data.py 说明文档

## 功能概述

`clean_csv_data.py` 是一个专门用于CSV数据清洗和列重排的工具，主要功能是将CSV文件按照特定的列顺序重新排列，确保关键列存在，并对数值型数据进行格式化。该工具可以单独使用，也可以作为数据处理流程的最后一步。

## 主要功能

1. **列重新排序**：按照预定义的顺序重排CSV文件中的列
2. **缺失列处理**：检查并添加必需的列（使用默认值）
3. **列重命名**：标准化列名称（如WaferID→Wafer）
4. **数值格式化**：根据数值大小选择合适的格式（科学计数法或小数位数）

## 命令行参数

```
python clean_csv_data.py 输入文件路径 [-o 输出文件路径]
```

| 参数 | 短选项 | 描述 | 必需 |
|------|-------|------|------|
| `input_file` | - | 输入CSV文件路径 | 是 |
| `--output_file` | `-o` | 输出CSV文件路径 | 否 |

## 列排序规则

CSV文件中的列将按以下顺序排列：
1. **固定列**（按此顺序）：Wafer, Seq, Bin, X, Y, No.U, CONT
2. **优先参数列**（如果存在）：IGSS0, IGSS1, IGSSR1, BVDSS1等重要参数
3. **其他列**：按字母顺序排列的其余参数列

## 主要函数

| 函数名 | 描述 |
|--------|------|
| `clean_csv_data` | 主处理函数，读取CSV文件并按规则重排列顺序 |
| `format_number` | 根据数值大小选择合适的格式化方式 |
| `main` | 处理命令行参数并调用主处理函数 |

## 数值格式化规则

- **极小值**（<0.0001）：使用科学计数法，保留2位有效数字
- **小值**（<10）：保留2位小数
- **普通数值**：保留3位有效数字

## 输出文件

如果未指定输出文件路径，工具会自动生成带有时间戳的输出文件名：
`{输入文件名}_cleaned_{timestamp}.csv`

## 使用示例

```python
# 基本用法，自动生成输出文件名
python clean_csv_data.py output/FA53_20250513_164637.csv

# 指定输出文件路径
python clean_csv_data.py output/FA53_20250513_164637.csv -o output/FA53_cleaned.csv

# 作为导入模块使用
from clean_csv_data import clean_csv_data
cleaned_file = clean_csv_data("input.csv", "output.csv")
```

## 列处理细节

1. **缺失的必需列处理**：
   - Bin, X, Y：默认值为0
   - No.U：默认值为1
   - CONT：默认值为空字符串
   - Wafer：尝试从文件名提取

2. **列重命名**：
   - WaferID → Wafer（确保统一的列名）

## 注意事项

- 工具会保留所有原始数据列，只改变顺序
- 数值列的格式化不会改变底层数据值，只影响显示格式
- 输出文件不包含原始CSV的索引列（如果有）

## 未来改进方向

1. 支持更多自定义列排序规则
2. 添加数据过滤功能
3. 增强数值格式化选项
4. 添加数据验证和完整性检查
5. 支持更多输入/输出格式

</rewritten_file> 