# JavaScriptåµŒå…¥æ”¹è¿›è¯´æ˜

## é—®é¢˜æè¿°

ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæ‰€æœ‰ç”Ÿæˆçš„HTMLå›¾è¡¨æ–‡ä»¶éƒ½ä¾èµ–äºunpkg CDNæ¥åŠ è½½Plotly.jsåº“ï¼š
```
include_plotlyjs='https://unpkg.com/plotly.js@2.26.0/dist/plotly.min.js'
```

è¿™ç§æ–¹å¼å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- **ç½‘ç»œä¾èµ–**ï¼šç”¨æˆ·éœ€è¦èƒ½å¤Ÿè®¿é—®unpkg.comç½‘ç«™
- **åŠ è½½å¤±è´¥**ï¼šåœ¨ç½‘ç»œå—é™æˆ–CDNä¸å¯ç”¨æ—¶ï¼Œå›¾è¡¨æ— æ³•æ­£å¸¸æ˜¾ç¤º
- **ç¨³å®šæ€§é—®é¢˜**ï¼šä¾èµ–å¤–éƒ¨æœåŠ¡çš„å¯ç”¨æ€§

## è§£å†³æ–¹æ¡ˆ

### 1. æ–°å¢JavaScriptåµŒå…¥å·¥å…·æ¨¡å—

åˆ›å»ºäº† `frontend/charts/js_embedder.py` æ¨¡å—ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
- è‡ªåŠ¨æ£€æµ‹é¡¹ç›®æ ¹ç›®å½•ä¸­çš„ `plotly.min.js` æ–‡ä»¶
- å°†JavaScriptå†…å®¹å®Œæ•´åµŒå…¥åˆ°HTMLæ–‡ä»¶ä¸­
- æ”¯æŒç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤è¯»å–æ–‡ä»¶
- ä¼˜é›…é™çº§ï¼šå¦‚æœæœ¬åœ°æ–‡ä»¶ä¸å¯ç”¨ï¼Œè‡ªåŠ¨å›é€€åˆ°é»˜è®¤CDN

### 2. æ ¸å¿ƒåŠŸèƒ½

```python
from frontend.charts.js_embedder import get_embedded_plotly_js

# æ›¿æ¢åŸæ¥çš„CDNé“¾æ¥
fig.write_html(
    str(file_path),
    include_plotlyjs=get_embedded_plotly_js(),  # æœ¬åœ°åµŒå…¥
    validate=False
)
```

### 3. æ¶‰åŠçš„æ–‡ä»¶ä¿®æ”¹

ä»¥ä¸‹æ–‡ä»¶å·²å®ŒæˆCDNåˆ°æœ¬åœ°åµŒå…¥çš„è¿ç§»ï¼š

1. **frontend/charts/boxplot_chart.py**
   - `save_chart()` æ–¹æ³•
   - `save_all_charts()` æ–¹æ³•

2. **frontend/charts/summary_chart/summary_chart.py**
   - `save_summary_chart()` æ–¹æ³•

3. **frontend/charts/yield_chart.py**
   - `save_chart()` æ–¹æ³•
   - `save_all_charts()` æ–¹æ³•

4. **chart_generator.py**
   - ç®±ä½“å›¾ç”Ÿæˆéƒ¨åˆ†
   - æ•£ç‚¹å›¾ç”Ÿæˆéƒ¨åˆ†

5. **frontend/charts/boxplot_chart_app.py**
   - Streamlitä¸‹è½½åŠŸèƒ½

## ä½¿ç”¨æ–¹æ³•

### 1. ä¸‹è½½Plotly.jsæ–‡ä»¶

é¡¹ç›®æ ¹ç›®å½•å·²åŒ…å« `plotly.min.js` æ–‡ä»¶ï¼ˆç‰ˆæœ¬2.26.0ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨ä¸‹è½½ã€‚

å¦‚éœ€æ›´æ–°ç‰ˆæœ¬ï¼Œå¯æ‰§è¡Œï¼š
```bash
curl -o plotly.min.js https://unpkg.com/plotly.js@2.26.0/dist/plotly.min.js
```

### 2. éªŒè¯åŠŸèƒ½

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼š
```bash
python test_js_embedder.py
```

### 3. ç”Ÿæˆå›¾è¡¨

ä½¿ç”¨ä»»ä½•ç°æœ‰çš„å›¾è¡¨ç”Ÿæˆå·¥å…·ï¼Œç”Ÿæˆçš„HTMLæ–‡ä»¶å°†è‡ªåŠ¨åŒ…å«å®Œæ•´çš„Plotly.jsä»£ç ï¼Œæ— éœ€ç½‘ç»œè¿æ¥å³å¯æŸ¥çœ‹ã€‚

## ä¼˜åŠ¿

### âœ… æ”¹è¿›åçš„ä¼˜åŠ¿
- **å®Œå…¨ç¦»çº¿**ï¼šç”Ÿæˆçš„HTMLæ–‡ä»¶å¯ä»¥åœ¨æ— ç½‘ç»œç¯å¢ƒä¸‹æ­£å¸¸æŸ¥çœ‹
- **åŠ è½½ç¨³å®š**ï¼šä¸ä¾èµ–å¤–éƒ¨CDNæœåŠ¡çš„å¯ç”¨æ€§
- **ä¸€è‡´æ€§**ï¼šæ‰€æœ‰ç”¨æˆ·çœ‹åˆ°çš„å›¾è¡¨å®Œå…¨ä¸€è‡´ï¼Œä¸å—ç½‘ç»œç¯å¢ƒå½±å“
- **å‘åå…¼å®¹**ï¼šå¦‚æœæœ¬åœ°æ–‡ä»¶ä¸å¯ç”¨ï¼Œè‡ªåŠ¨å›é€€åˆ°CDNæ¨¡å¼

### ğŸ“Š æ–‡ä»¶å¤§å°å¯¹æ¯”
- **CDNç‰ˆæœ¬**ï¼šHTMLæ–‡ä»¶å¾ˆå°ï¼ˆ~50KBï¼‰ï¼Œä½†éœ€è¦ç½‘ç»œåŠ è½½JSï¼ˆ~3.6MBï¼‰
- **åµŒå…¥ç‰ˆæœ¬**ï¼šHTMLæ–‡ä»¶è¾ƒå¤§ï¼ˆ~3.7MBï¼‰ï¼Œä½†å®Œå…¨è‡ªåŒ…å«

## æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶å¤§å°**ï¼šåµŒå…¥ç‰ˆæœ¬çš„HTMLæ–‡ä»¶ä¼šå¢å¤§çº¦3.6MBï¼Œä½†æ¢æ¥äº†å®Œå…¨çš„ç‹¬ç«‹æ€§
2. **ç‰ˆæœ¬ç®¡ç†**ï¼šæ›´æ–°Plotly.jsç‰ˆæœ¬éœ€è¦é‡æ–°ä¸‹è½½æ–‡ä»¶åˆ°é¡¹ç›®æ ¹ç›®å½•
3. **å¤‡ä»½æœºåˆ¶**ï¼šå¦‚æœæ£€æµ‹ä¸åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨CDNä½œä¸ºå¤‡ä»½

## æŠ€æœ¯ç»†èŠ‚

### è‡ªåŠ¨è·¯å¾„æ£€æµ‹
```python
# ä»frontend/charts/js_embedder.pyå‘ä¸Šæ‰¾åˆ°é¡¹ç›®æ ¹ç›®å½•
current_file = Path(__file__)
self.project_root = current_file.parent.parent.parent
self.plotly_js_path = self.project_root / "plotly.min.js"
```

### ç¼“å­˜æœºåˆ¶
```python
if self._plotly_js_content is not None:
    return self._plotly_js_content  # ä½¿ç”¨ç¼“å­˜ï¼Œé¿å…é‡å¤è¯»å–
```

### é”™è¯¯å¤„ç†
```python
js_content = self.get_plotly_js_content()
if js_content is None:
    logger.warning("æ— æ³•åŠ è½½æœ¬åœ°Plotly.jsï¼Œå°†ä½¿ç”¨é»˜è®¤CDN")
    return True  # å›é€€åˆ°Plotlyé»˜è®¤CDN
```

## æ€»ç»“

è¿™æ¬¡æ”¹è¿›æˆåŠŸè§£å†³äº†CDNä¾èµ–é—®é¢˜ï¼Œè®©ç”Ÿæˆçš„å›¾è¡¨æ–‡ä»¶å…·å¤‡äº†å®Œå…¨çš„ç¦»çº¿æŸ¥çœ‹èƒ½åŠ›ï¼Œå¤§å¤§æå‡äº†ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿç¨³å®šæ€§ã€‚ç”¨æˆ·ä¸å†éœ€è¦æ‹…å¿ƒç½‘ç»œé—®é¢˜å¯¼è‡´çš„å›¾è¡¨æ˜¾ç¤ºå¼‚å¸¸ã€‚ 