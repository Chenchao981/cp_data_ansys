# CPæ•°æ®åˆ†æå™¨æ€§èƒ½ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ

## ğŸ“Š æ›´æ–°åçš„æ€§èƒ½åŸºçº¿

### æ•°æ®è§„æ¨¡åˆ†æï¼ˆé‡æ–°è¯„ä¼°ï¼‰
- **æ–‡ä»¶æ•°é‡**: åŠ¨æ€æ•°é‡ï¼ˆåŸºäºä¸Šä¼ æ–‡ä»¶å¤¹ï¼‰
- **æ•°æ®æ€»é‡**: **~10ä¸‡è¡Œ**æµ‹è¯•æ•°æ®ï¼ˆæ¯”åŸä¼°è®¡å¤§7å€ï¼‰
- **å‚æ•°æ•°é‡**: **10-20ä¸ª**æµ‹é‡å‚æ•°ï¼ˆå¯å˜ï¼‰
- **ç¡¬ä»¶ç¯å¢ƒ**: **16-32GBå†…å­˜**ï¼ˆå……è¶³èµ„æºï¼‰
- **å½“å‰å¤„ç†æ—¶é—´**: é¢„ä¼°60-120ç§’ï¼ˆåŸºäºæ•°æ®è§„æ¨¡æ¨ç®—ï¼‰
- **å†…å­˜ä½¿ç”¨**: å¯å……åˆ†åˆ©ç”¨ï¼Œæ— ä¸¥æ ¼é™åˆ¶

### æ€§èƒ½ç“¶é¢ˆé‡æ–°è¯†åˆ«
1. **æ•°æ®è¯»å–**: å¤§é‡æ–‡ä»¶I/Oï¼Œå¯èƒ½æ•°ç™¾ä¸ªæ–‡ä»¶
2. **æ•£ç‚¹ä¼˜åŒ–**: 10-20ä¸ªå‚æ•° Ã— 0.5ç§’ = 5-10ç§’
3. **å›¾è¡¨ç”Ÿæˆ**: 10-20ä¸ªå›¾è¡¨ä¸²è¡Œç”Ÿæˆï¼Œè€—æ—¶å·¨å¤§
4. **å†…å­˜ç®¡ç†**: 10ä¸‡è¡Œæ•°æ®å…¨åŠ è½½ï¼Œå†…å­˜å‹åŠ›å¤§
5. **æ•°æ®å¤„ç†**: è®¡ç®—å¯†é›†å‹æ“ä½œåœ¨å¤§æ•°æ®é›†ä¸Šå¾ˆæ…¢

---

## ğŸ¯ é‡æ–°å®šä¹‰çš„ä¼˜åŒ–ç›®æ ‡

| æ€§èƒ½æŒ‡æ ‡ | å½“å‰å€¼ï¼ˆæ¨ç®—ï¼‰ | ç›®æ ‡å€¼ | æå‡å€æ•° |
|----------|---------------|--------|----------|
| æ€»å¤„ç†æ—¶é—´ | 60-120ç§’ | 15-25ç§’ | 4-5x |
| æ•°æ®æ¸…æ´— | ~15ç§’ | ~3ç§’ | 5x |
| æ•£ç‚¹ä¼˜åŒ– | 5-10ç§’ | 1-2ç§’ | 5x |
| å›¾è¡¨ç”Ÿæˆ | 30-60ç§’ | 8-15ç§’ | 4x |
| å†…å­˜ä½¿ç”¨ | å……åˆ†åˆ©ç”¨ | 4-8GBå³°å€¼ | é«˜æ•ˆåˆ©ç”¨ |
| CPUåˆ©ç”¨ç‡ | å•æ ¸15% | å¤šæ ¸80%+ | 20x+ |

---

## ğŸ“… é’ˆå¯¹å¤§æ•°æ®é‡çš„ä¼˜åŒ–ç­–ç•¥

### é˜¶æ®µ1ï¼šå¤§æ•°æ®é‡åŸºç¡€ä¼˜åŒ–ï¼ˆç¬¬1-2å‘¨ï¼‰
**ç›®æ ‡**: é’ˆå¯¹10ä¸‡è¡Œæ•°æ®å’Œé«˜å†…å­˜ç¯å¢ƒä¼˜åŒ–

#### 1.1 é«˜å†…å­˜ç¯å¢ƒé…ç½®
- å……åˆ†åˆ©ç”¨16-32GBå†…å­˜
- æé«˜æ•°æ®ç¼“å­˜å’Œé¢„å¤„ç†æ•ˆç‡
- ä¼˜åŒ–å†…å­˜åˆ†é…ç­–ç•¥

#### 1.2 å¤§æ•°æ®é‡NumbaåŠ é€Ÿ
- é‡ç‚¹ä¼˜åŒ–10ä¸‡è¡Œæ•°æ®çš„è®¡ç®—
- å¹¶è¡Œå¤„ç†å¤§æ•°ç»„æ“ä½œ
- å‘é‡åŒ–ç»Ÿè®¡è®¡ç®—

#### 1.3 æ™ºèƒ½å¹¶è¡Œç­–ç•¥
- åŠ¨æ€æ£€æµ‹æ–‡ä»¶æ•°é‡
- è‡ªé€‚åº”è°ƒæ•´å·¥ä½œè¿›ç¨‹æ•°
- I/Oå’Œè®¡ç®—çš„æµæ°´çº¿å¤„ç†

**é¢„æœŸæ•ˆæœ**: å¤„ç†æ—¶é—´å‡å°‘åˆ°40-60ç§’

### é˜¶æ®µ2ï¼šé«˜æ€§èƒ½å¹¶è¡Œæ¶æ„ï¼ˆç¬¬3-4å‘¨ï¼‰
**ç›®æ ‡**: å……åˆ†åˆ©ç”¨å¤šæ ¸CPUå’Œå¤§å†…å­˜

#### 2.1 å†…å­˜å¯†é›†å‹ä¼˜åŒ–
- å¤§å®¹é‡æ•°æ®é¢„åŠ è½½
- æ™ºèƒ½å†…å­˜æ± ç®¡ç†
- é›¶æ‹·è´æ•°æ®ä¼ é€’

#### 2.2 å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†
- å¤šè¿›ç¨‹+å¤šçº¿ç¨‹æ··åˆæ¶æ„
- æ•°æ®åˆ†ç‰‡å¹¶è¡Œè®¡ç®—
- å¼‚æ­¥I/Oå’Œè®¡ç®—é‡å 

#### 2.3 é«˜æ•ˆç¼“å­˜ç³»ç»Ÿ
- å¤§å®¹é‡å†…å­˜ç¼“å­˜ï¼ˆ2-4GBï¼‰
- è®¡ç®—ç»“æœæŒä¹…åŒ–
- æ™ºèƒ½é¢„è®¡ç®—æœºåˆ¶

**é¢„æœŸæ•ˆæœ**: å¤„ç†æ—¶é—´å‡å°‘åˆ°20-35ç§’

### é˜¶æ®µ3ï¼šæè‡´æ€§èƒ½ä¼˜åŒ–ï¼ˆç¬¬5-6å‘¨ï¼‰
**ç›®æ ‡**: è¾¾åˆ°ç¡¬ä»¶æ€§èƒ½æé™

#### 3.1 GPUåŠ é€Ÿï¼ˆå¯é€‰ï¼‰
- ä½¿ç”¨CUDA/OpenCLåŠ é€Ÿè®¡ç®—
- å¤§è§„æ¨¡å¹¶è¡Œæ•°æ®å¤„ç†
- GPUå†…å­˜ä¼˜åŒ–

#### 3.2 ä¸“ä¸šçº§ä¼˜åŒ–
- Cæ‰©å±•å…³é”®ç®—æ³•
- å†…å­˜æ˜ å°„æ–‡ä»¶å¤„ç†
- é«˜æ€§èƒ½æ•°æ®ç»“æ„

#### 3.3 æ™ºèƒ½é¢„å¤„ç†
- å¢é‡æ•°æ®å¤„ç†
- åå°é¢„è®¡ç®—
- ç»“æœé¢„æµ‹å’Œç¼“å­˜

**é¢„æœŸæ•ˆæœ**: å¤„ç†æ—¶é—´ç¨³å®šåœ¨15-25ç§’

---

## ğŸ› ï¸ å¤§æ•°æ®é‡æŠ€æœ¯å®æ–½

### é’ˆå¯¹10ä¸‡è¡Œæ•°æ®çš„æ ¸å¿ƒä¼˜åŒ–

#### 1. é«˜æ€§èƒ½é…ç½®è°ƒæ•´
```python
# å¤§æ•°æ®é‡ä¸“ç”¨é…ç½®
LARGE_DATASET_CONFIG = {
    'memory': {
        'limit_mb': 8192,  # 8GBå†…å­˜é™åˆ¶
        'chunk_size': 20000,  # 2ä¸‡è¡Œä¸€å—
        'preload_data': True,  # é¢„åŠ è½½æ‰€æœ‰æ•°æ®
        'use_memory_pool': True,  # ä½¿ç”¨å†…å­˜æ± 
    },
    'parallel': {
        'max_workers': 12,  # æ›´å¤šå·¥ä½œè¿›ç¨‹
        'io_workers': 24,   # æ›´å¤šI/Oçº¿ç¨‹
        'enable_gpu': False,  # GPUåŠ é€Ÿï¼ˆå¯é€‰ï¼‰
    },
    'cache': {
        'size_mb': 2048,  # 2GBç¼“å­˜
        'enable_persistent': True,  # æŒä¹…åŒ–ç¼“å­˜
    }
}
```

#### 2. å¤§æ•°æ®é‡Numbaä¼˜åŒ–
```python
@njit(parallel=True, cache=True)
def process_large_dataset_numba(data_array, param_count):
    """é’ˆå¯¹10ä¸‡è¡Œæ•°æ®çš„Numbaä¼˜åŒ–"""
    n_rows, n_cols = data_array.shape
    results = np.zeros((param_count, 5))  # å­˜å‚¨ç»Ÿè®¡ç»“æœ
    
    # å¹¶è¡Œå¤„ç†æ¯ä¸ªå‚æ•°
    for param_idx in prange(param_count):
        param_data = data_array[:, param_idx]
        # å¿«é€Ÿç»Ÿè®¡è®¡ç®—
        results[param_idx, 0] = np.mean(param_data)
        results[param_idx, 1] = np.std(param_data)
        results[param_idx, 2] = np.min(param_data)
        results[param_idx, 3] = np.max(param_data)
        results[param_idx, 4] = np.median(param_data)
    
    return results
```

#### 3. å¤§è§„æ¨¡å¹¶è¡Œå›¾è¡¨ç”Ÿæˆ
```python
class LargeDatasetChartGenerator:
    """å¤§æ•°æ®é‡å›¾è¡¨ç”Ÿæˆå™¨"""
    
    def __init__(self, data, memory_limit_gb=8):
        self.data = data
        self.memory_limit = memory_limit_gb * 1024 * 1024 * 1024
        self.chunk_size = self._calculate_optimal_chunk_size()
    
    async def generate_all_charts_parallel(self, parameters):
        """å¹¶è¡Œç”Ÿæˆæ‰€æœ‰å›¾è¡¨"""
        # åˆ†æ‰¹å¤„ç†å‚æ•°ï¼Œé¿å…å†…å­˜æº¢å‡º
        batches = self._create_parameter_batches(parameters, batch_size=4)
        
        all_charts = []
        for batch in batches:
            # æ¯æ‰¹å¹¶è¡Œå¤„ç†
            batch_charts = await asyncio.gather(*[
                self._generate_chart_async(param) for param in batch
            ])
            all_charts.extend(batch_charts)
            
            # æ‰¹æ¬¡é—´æ¸…ç†å†…å­˜
            gc.collect()
        
        return all_charts
```

---

## ğŸ“Š å¤§æ•°æ®é‡æ€§èƒ½æµ‹è¯•åŸºå‡†

### æµ‹è¯•æ•°æ®é›†
- **å°æ•°æ®é›†**: 1ä¸‡è¡Œï¼Œ5å‚æ•°
- **ä¸­æ•°æ®é›†**: 5ä¸‡è¡Œï¼Œ10å‚æ•°  
- **å¤§æ•°æ®é›†**: 10ä¸‡è¡Œï¼Œ15å‚æ•°
- **è¶…å¤§æ•°æ®é›†**: 20ä¸‡è¡Œï¼Œ20å‚æ•°

### æ€§èƒ½ç›®æ ‡ï¼ˆ16GBå†…å­˜æœºå™¨ï¼‰
| æ•°æ®é›†è§„æ¨¡ | å½“å‰é¢„ä¼°æ—¶é—´ | ç›®æ ‡æ—¶é—´ | å†…å­˜ä½¿ç”¨ |
|------------|--------------|----------|----------|
| 1ä¸‡è¡ŒÃ—5å‚æ•° | 15ç§’ | 3ç§’ | 1GB |
| 5ä¸‡è¡ŒÃ—10å‚æ•° | 45ç§’ | 10ç§’ | 3GB |
| 10ä¸‡è¡ŒÃ—15å‚æ•° | 90ç§’ | 20ç§’ | 6GB |
| 20ä¸‡è¡ŒÃ—20å‚æ•° | 180ç§’ | 45ç§’ | 12GB |

---

## ğŸš€ ç«‹å³å¯å®æ–½çš„ä¼˜åŒ–

### ç¬¬ä¸€æ­¥ï¼šæ›´æ–°æ€§èƒ½é…ç½®
- è°ƒæ•´å†…å­˜é™åˆ¶åˆ°8GB
- å¢åŠ å¹¶è¡Œå·¥ä½œè¿›ç¨‹åˆ°12ä¸ª
- å¯ç”¨å¤§æ•°æ®é‡ä¼˜åŒ–æ¨¡å¼

### ç¬¬äºŒæ­¥ï¼šå®ç°æ‰¹é‡å¤„ç†
- æŒ‰å‚æ•°åˆ†æ‰¹ç”Ÿæˆå›¾è¡¨
- å‡å°‘å†…å­˜å³°å€¼ä½¿ç”¨
- æé«˜å¹¶è¡Œæ•ˆç‡

### ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ è¿›åº¦ç›‘æ§
- å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦
- ä¼°ç®—å‰©ä½™æ—¶é—´
- æ”¯æŒä¸­é€”å–æ¶ˆ

---

## ğŸ¯ æˆåŠŸæ ‡å‡†ï¼ˆæ›´æ–°ï¼‰

### æ€§èƒ½æŒ‡æ ‡
- âœ… 10ä¸‡è¡Œæ•°æ®å¤„ç†æ—¶é—´ â‰¤ 25ç§’
- âœ… 20ä¸ªå‚æ•°å›¾è¡¨ç”Ÿæˆ â‰¤ 15ç§’
- âœ… å†…å­˜ä½¿ç”¨å³°å€¼ â‰¤ 8GB
- âœ… CPUå¤šæ ¸åˆ©ç”¨ç‡ â‰¥ 80%
- âœ… æ”¯æŒæ–‡ä»¶æ•°é‡åŠ¨æ€æ£€æµ‹

### æ‰©å±•æ€§
- âœ… æ”¯æŒ1-50ä¸‡è¡Œæ•°æ®
- âœ… æ”¯æŒ5-30ä¸ªå‚æ•°
- âœ… è‡ªåŠ¨é€‚åº”ä¸åŒç¡¬ä»¶é…ç½®
- âœ… ä¼˜é›…é™çº§æœºåˆ¶

---

---

## ğŸš€ ç«‹å³å¼€å§‹ä¼˜åŒ–ï¼ˆ5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²ï¼‰

### ç¬¬ä¸€æ­¥ï¼šä¸€é”®éƒ¨ç½²
```bash
# è¿è¡Œå¿«é€Ÿéƒ¨ç½²è„šæœ¬
python å¿«é€Ÿéƒ¨ç½²ä¼˜åŒ–.py
```

### ç¬¬äºŒæ­¥ï¼šéªŒè¯ä¼˜åŒ–æ•ˆæœ
```bash
# è¿è¡Œæ€§èƒ½æµ‹è¯•ç¤ºä¾‹
python æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹.py
```

### ç¬¬ä¸‰æ­¥ï¼šé›†æˆåˆ°ç°æœ‰ä»£ç 
```python
# åœ¨ä½ çš„CPæ•°æ®å¤„ç†ä»£ç ä¸­æ·»åŠ ï¼š
from cp_data_processor.processing.numba_accelerators import batch_process_parameters

# æ›¿æ¢åŸæœ‰çš„é€ä¸ªå‚æ•°å¤„ç†
results = batch_process_parameters(
    df, 
    parameter_columns,
    enable_outlier_detection=True,
    enable_scatter_optimization=True
)

# ç«‹å³è·å¾—3-5å€æ€§èƒ½æå‡ï¼
```

---

## ğŸ“‹ åˆ†æ­¥éª¤å®æ–½æ¸…å•

### âœ… ç¬¬1å‘¨ï¼šåŸºç¡€ä¼˜åŒ–ï¼ˆç«‹å³è§æ•ˆï¼‰
- [ ] è¿è¡Œ `python å¿«é€Ÿéƒ¨ç½²ä¼˜åŒ–.py`
- [ ] å®‰è£…numbaã€psutilç­‰ä¾èµ–åŒ…
- [ ] éªŒè¯Numbaç¼–è¯‘å’Œæ€§èƒ½
- [ ] åˆ›å»ºæ€§èƒ½é…ç½®æ–‡ä»¶
- [ ] è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼Œç¡®è®¤ä¼˜åŒ–æ•ˆæœ

**é¢„æœŸæ•ˆæœ**: å¤„ç†æ—¶é—´å‡å°‘50-70%

### âœ… ç¬¬2å‘¨ï¼šæ·±åº¦é›†æˆ
- [ ] å°†NumbaåŠ é€Ÿé›†æˆåˆ°ç°æœ‰ä»£ç 
- [ ] å¯ç”¨æ‰¹é‡å‚æ•°å¤„ç†
- [ ] é…ç½®å†…å­˜å’Œå¹¶è¡Œå‚æ•°
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§
- [ ] æµ‹è¯•ä¸åŒæ•°æ®è§„æ¨¡çš„è¡¨ç°

**é¢„æœŸæ•ˆæœ**: å¤„ç†æ—¶é—´ç¨³å®šåœ¨20-30ç§’

### âœ… ç¬¬3å‘¨ï¼šé«˜çº§ä¼˜åŒ–
- [ ] å¯ç”¨å¹¶è¡Œå¤„ç†å™¨
- [ ] ä¼˜åŒ–å›¾è¡¨ç”Ÿæˆæµç¨‹
- [ ] å®ç°æ™ºèƒ½ç¼“å­˜
- [ ] æ·»åŠ è¿›åº¦æ˜¾ç¤º
- [ ] æ€§èƒ½è°ƒä¼˜å’Œç¨³å®šæ€§æµ‹è¯•

**é¢„æœŸæ•ˆæœ**: å¤„ç†æ—¶é—´è¿›ä¸€æ­¥å‡å°‘åˆ°15-25ç§’

---

## ğŸ’¡ å…³é”®ä»£ç ç‰‡æ®µ

### æ›¿æ¢åŸæœ‰çš„å‚æ•°ç»Ÿè®¡è®¡ç®—
```python
# âŒ åŸæ¥çš„ä»£ç ï¼ˆæ…¢ï¼‰
statistics = {}
for param in parameter_columns:
    param_data = df[param].dropna()
    statistics[param] = {
        'mean': param_data.mean(),
        'std': param_data.std(),
        # ... å…¶ä»–ç»Ÿè®¡é‡
    }

# âœ… ä¼˜åŒ–åçš„ä»£ç ï¼ˆå¿«ï¼‰
from cp_data_processor.processing.numba_accelerators import batch_process_parameters

results = batch_process_parameters(df, parameter_columns)
statistics = results['statistics']
outliers = results['outliers']
```

### æ›¿æ¢åŸæœ‰çš„æ•°æ®ä¼˜åŒ–
```python
# âŒ åŸæ¥çš„ä»£ç ï¼ˆå†…å­˜å ç”¨å¤§ï¼‰
optimized_df = df.copy()  # å¤åˆ¶æ•´ä¸ªDataFrame

# âœ… ä¼˜åŒ–åçš„ä»£ç ï¼ˆå†…å­˜æ•ˆç‡é«˜ï¼‰
results = batch_process_parameters(df, parameter_columns, enable_scatter_optimization=True)
optimized_indices = results['optimized_indices']
optimized_df = df.iloc[optimized_indices]

print(f"æ•°æ®ä¼˜åŒ–ï¼š{len(df)} -> {len(optimized_df)} è¡Œ "
      f"(å‡å°‘ {results['processing_info']['reduction_percentage']:.1f}%)")
```

### æ·»åŠ å¹¶è¡Œå¤„ç†
```python
# âœ… å¤§æ•°æ®é›†ä½¿ç”¨å¹¶è¡Œå¤„ç†
from cp_data_processor.processing.parallel_processor import create_parallel_processor

if len(df) > 50000:  # 5ä¸‡è¡Œä»¥ä¸Šä½¿ç”¨å¹¶è¡Œ
    processor = create_parallel_processor(data_size_hint=len(df))
    try:
        processor.start()
        results = processor.process_large_dataset(df, parameter_columns)
    finally:
        processor.stop()
else:
    # å°æ•°æ®é›†ç›´æ¥ç”¨Numba
    results = batch_process_parameters(df, parameter_columns)
```

---

## ğŸ¯ æ€§èƒ½ç›®æ ‡è¾¾æˆæ£€æŸ¥

### ç«‹å³å¯æµ‹è¯•çš„æ€§èƒ½æŒ‡æ ‡
```python
import time

# æµ‹è¯•ä»£ç 
start_time = time.time()
results = batch_process_parameters(df, parameter_columns)
processing_time = time.time() - start_time

# æ€§èƒ½æ£€æŸ¥
data_size = len(df)
param_count = len(parameter_columns)

print(f"æ•°æ®è§„æ¨¡: {data_size:,} è¡Œ Ã— {param_count} å‚æ•°")
print(f"å¤„ç†æ—¶é—´: {processing_time:.2f} ç§’")
print(f"å¤„ç†é€Ÿç‡: {data_size/processing_time:,.0f} è¡Œ/ç§’")

# ç›®æ ‡æ£€æŸ¥
target_time = {
    10000: 3,    # 1ä¸‡è¡Œç›®æ ‡3ç§’
    50000: 10,   # 5ä¸‡è¡Œç›®æ ‡10ç§’  
    100000: 20,  # 10ä¸‡è¡Œç›®æ ‡20ç§’
    200000: 45,  # 20ä¸‡è¡Œç›®æ ‡45ç§’
}

expected = next((t for size, t in target_time.items() if data_size <= size), 60)

if processing_time <= expected:
    print(f"âœ… æ€§èƒ½è¾¾æ ‡ï¼(ç›®æ ‡: â‰¤{expected}ç§’)")
else:
    print(f"âš ï¸  æ€§èƒ½å¾…ä¼˜åŒ– (ç›®æ ‡: â‰¤{expected}ç§’)")
```

---

**æ›´æ–°ç‰ˆæœ¬**: v2.1  
**æ›´æ–°æ—¥æœŸ**: 2025-01-06  
**é€‚ç”¨ç¯å¢ƒ**: å¤§æ•°æ®é‡+é«˜å†…å­˜é…ç½®  
**å¿«é€Ÿéƒ¨ç½²**: æ”¯æŒ5åˆ†é’Ÿä¸€é”®éƒ¨ç½² 